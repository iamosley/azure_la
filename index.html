<!doctype html>
<html>
<head>
<meta charset='UTF-8'><meta name='viewport' content='width=device-width initial-scale=1'>

<link href='https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext' rel='stylesheet' type='text/css' /><style type='text/css'>html {overflow-x: initial !important;}:root { --bg-color:#ffffff; --text-color:#333333; --select-text-bg-color:#B5D6FC; --select-text-font-color:auto; --monospace:"Lucida Console",Consolas,"Courier",monospace; --title-bar-height:20px; }
.mac-os-11 { --title-bar-height:28px; }
html { font-size: 14px; background-color: var(--bg-color); color: var(--text-color); font-family: "Helvetica Neue", Helvetica, Arial, sans-serif; -webkit-font-smoothing: antialiased; }
body { margin: 0px; padding: 0px; height: auto; inset: 0px; font-size: 1rem; line-height: 1.42857; overflow-x: hidden; background: inherit; tab-size: 4; }
iframe { margin: auto; }
a.url { word-break: break-all; }
a:active, a:hover { outline: 0px; }
.in-text-selection, ::selection { text-shadow: none; background: var(--select-text-bg-color); color: var(--select-text-font-color); }
#write { margin: 0px auto; height: auto; width: inherit; word-break: normal; overflow-wrap: break-word; position: relative; white-space: normal; overflow-x: visible; padding-top: 36px; }
#write.first-line-indent p { text-indent: 2em; }
#write.first-line-indent li p, #write.first-line-indent p * { text-indent: 0px; }
#write.first-line-indent li { margin-left: 2em; }
.for-image #write { padding-left: 8px; padding-right: 8px; }
body.typora-export { padding-left: 30px; padding-right: 30px; }
.typora-export .footnote-line, .typora-export li, .typora-export p { white-space: pre-wrap; }
.typora-export .task-list-item input { pointer-events: none; }
@media screen and (max-width: 500px) {
  body.typora-export { padding-left: 0px; padding-right: 0px; }
  #write { padding-left: 20px; padding-right: 20px; }
  .CodeMirror-sizer { margin-left: 0px !important; }
  .CodeMirror-gutters { display: none !important; }
}
#write li > figure:last-child { margin-bottom: 0.5rem; }
#write ol, #write ul { position: relative; }
img { max-width: 100%; vertical-align: middle; image-orientation: from-image; }
button, input, select, textarea { color: inherit; font: inherit; }
input[type="checkbox"], input[type="radio"] { line-height: normal; padding: 0px; }
*, ::after, ::before { box-sizing: border-box; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p, #write pre { width: inherit; }
#write h1, #write h2, #write h3, #write h4, #write h5, #write h6, #write p { position: relative; }
p { line-height: inherit; }
h1, h2, h3, h4, h5, h6 { break-after: avoid-page; break-inside: avoid; orphans: 4; }
p { orphans: 4; }
h1 { font-size: 2rem; }
h2 { font-size: 1.8rem; }
h3 { font-size: 1.6rem; }
h4 { font-size: 1.4rem; }
h5 { font-size: 1.2rem; }
h6 { font-size: 1rem; }
.md-math-block, .md-rawblock, h1, h2, h3, h4, h5, h6, p { margin-top: 1rem; margin-bottom: 1rem; }
.hidden { display: none; }
.md-blockmeta { color: rgb(204, 204, 204); font-weight: 700; font-style: italic; }
a { cursor: pointer; }
sup.md-footnote { padding: 2px 4px; background-color: rgba(238, 238, 238, 0.7); color: rgb(85, 85, 85); border-radius: 4px; cursor: pointer; }
sup.md-footnote a, sup.md-footnote a:hover { color: inherit; text-transform: inherit; text-decoration: inherit; }
#write input[type="checkbox"] { cursor: pointer; width: inherit; height: inherit; }
figure { overflow-x: auto; margin: 1.2em 0px; max-width: calc(100% + 16px); padding: 0px; }
figure > table { margin: 0px; }
tr { break-inside: avoid; break-after: auto; }
thead { display: table-header-group; }
table { border-collapse: collapse; border-spacing: 0px; width: 100%; overflow: auto; break-inside: auto; text-align: left; }
table.md-table td { min-width: 32px; }
.CodeMirror-gutters { border-right: 0px; background-color: inherit; }
.CodeMirror-linenumber { user-select: none; }
.CodeMirror { text-align: left; }
.CodeMirror-placeholder { opacity: 0.3; }
.CodeMirror pre { padding: 0px 4px; }
.CodeMirror-lines { padding: 0px; }
div.hr:focus { cursor: none; }
#write pre { white-space: pre-wrap; }
#write.fences-no-line-wrapping pre { white-space: pre; }
#write pre.ty-contain-cm { white-space: normal; }
.CodeMirror-gutters { margin-right: 4px; }
.md-fences { font-size: 0.9rem; display: block; break-inside: avoid; text-align: left; overflow: visible; white-space: pre; background: inherit; position: relative !important; }
.md-fences-adv-panel { width: 100%; margin-top: 10px; text-align: center; padding-top: 0px; padding-bottom: 8px; overflow-x: auto; }
#write .md-fences.mock-cm { white-space: pre-wrap; }
.md-fences.md-fences-with-lineno { padding-left: 0px; }
#write.fences-no-line-wrapping .md-fences.mock-cm { white-space: pre; overflow-x: auto; }
.md-fences.mock-cm.md-fences-with-lineno { padding-left: 8px; }
.CodeMirror-line, twitterwidget { break-inside: avoid; }
.footnotes { opacity: 0.8; font-size: 0.9rem; margin-top: 1em; margin-bottom: 1em; }
.footnotes + .footnotes { margin-top: 0px; }
.md-reset { margin: 0px; padding: 0px; border: 0px; outline: 0px; vertical-align: top; background: 0px 0px; text-decoration: none; text-shadow: none; float: none; position: static; width: auto; height: auto; white-space: nowrap; cursor: inherit; -webkit-tap-highlight-color: transparent; line-height: normal; font-weight: 400; text-align: left; box-sizing: content-box; direction: ltr; }
li div { padding-top: 0px; }
blockquote { margin: 1rem 0px; }
li .mathjax-block, li p { margin: 0.5rem 0px; }
li blockquote { margin: 1rem 0px; }
li { margin: 0px; position: relative; }
blockquote > :last-child { margin-bottom: 0px; }
blockquote > :first-child, li > :first-child { margin-top: 0px; }
.footnotes-area { color: rgb(136, 136, 136); margin-top: 0.714rem; padding-bottom: 0.143rem; white-space: normal; }
#write .footnote-line { white-space: pre-wrap; }
@media print {
  body, html { border: 1px solid transparent; height: 99%; break-after: avoid; break-before: avoid; font-variant-ligatures: no-common-ligatures; }
  #write { margin-top: 0px; padding-top: 0px; border-color: transparent !important; }
  .typora-export * { -webkit-print-color-adjust: exact; }
  .typora-export #write { break-after: avoid; }
  .typora-export #write::after { height: 0px; }
  .is-mac table { break-inside: avoid; }
  .typora-export-show-outline .typora-export-sidebar { display: none; }
}
.footnote-line { margin-top: 0.714em; font-size: 0.7em; }
a img, img a { cursor: pointer; }
pre.md-meta-block { font-size: 0.8rem; min-height: 0.8rem; white-space: pre-wrap; background: rgb(204, 204, 204); display: block; overflow-x: hidden; }
p > .md-image:only-child:not(.md-img-error) img, p > img:only-child { display: block; margin: auto; }
#write.first-line-indent p > .md-image:only-child:not(.md-img-error) img { left: -2em; position: relative; }
p > .md-image:only-child { display: inline-block; width: 100%; }
#write .MathJax_Display { margin: 0.8em 0px 0px; }
.md-math-block { width: 100%; }
.md-math-block:not(:empty)::after { display: none; }
.MathJax_ref { fill: currentcolor; }
[contenteditable="true"]:active, [contenteditable="true"]:focus, [contenteditable="false"]:active, [contenteditable="false"]:focus { outline: 0px; box-shadow: none; }
.md-task-list-item { position: relative; list-style-type: none; }
.task-list-item.md-task-list-item { padding-left: 0px; }
.md-task-list-item > input { position: absolute; top: 0px; left: 0px; margin-left: -1.2em; margin-top: calc(1em - 10px); border: none; }
.math { font-size: 1rem; }
.md-toc { min-height: 3.58rem; position: relative; font-size: 0.9rem; border-radius: 10px; }
.md-toc-content { position: relative; margin-left: 0px; }
.md-toc-content::after, .md-toc::after { display: none; }
.md-toc-item { display: block; color: rgb(65, 131, 196); }
.md-toc-item a { text-decoration: none; }
.md-toc-inner:hover { text-decoration: underline; }
.md-toc-inner { display: inline-block; cursor: pointer; }
.md-toc-h1 .md-toc-inner { margin-left: 0px; font-weight: 700; }
.md-toc-h2 .md-toc-inner { margin-left: 2em; }
.md-toc-h3 .md-toc-inner { margin-left: 4em; }
.md-toc-h4 .md-toc-inner { margin-left: 6em; }
.md-toc-h5 .md-toc-inner { margin-left: 8em; }
.md-toc-h6 .md-toc-inner { margin-left: 10em; }
@media screen and (max-width: 48em) {
  .md-toc-h3 .md-toc-inner { margin-left: 3.5em; }
  .md-toc-h4 .md-toc-inner { margin-left: 5em; }
  .md-toc-h5 .md-toc-inner { margin-left: 6.5em; }
  .md-toc-h6 .md-toc-inner { margin-left: 8em; }
}
a.md-toc-inner { font-size: inherit; font-style: inherit; font-weight: inherit; line-height: inherit; }
.footnote-line a:not(.reversefootnote) { color: inherit; }
.md-attr { display: none; }
.md-fn-count::after { content: "."; }
code, pre, samp, tt { font-family: var(--monospace); }
kbd { margin: 0px 0.1em; padding: 0.1em 0.6em; font-size: 0.8em; color: rgb(36, 39, 41); background: rgb(255, 255, 255); border: 1px solid rgb(173, 179, 185); border-radius: 3px; box-shadow: rgba(12, 13, 14, 0.2) 0px 1px 0px, rgb(255, 255, 255) 0px 0px 0px 2px inset; white-space: nowrap; vertical-align: middle; }
.md-comment { color: rgb(162, 127, 3); opacity: 0.8; font-family: var(--monospace); }
code { text-align: left; vertical-align: initial; }
a.md-print-anchor { white-space: pre !important; border-width: initial !important; border-style: none !important; border-color: initial !important; display: inline-block !important; position: absolute !important; width: 1px !important; right: 0px !important; outline: 0px !important; background: 0px 0px !important; text-decoration: initial !important; text-shadow: initial !important; }
.os-windows.monocolor-emoji .md-emoji { font-family: "Segoe UI Symbol", sans-serif; }
.md-diagram-panel > svg { max-width: 100%; }
[lang="flow"] svg, [lang="mermaid"] svg { max-width: 100%; height: auto; }
[lang="mermaid"] .node text { font-size: 1rem; }
table tr th { border-bottom: 0px; }
video { max-width: 100%; display: block; margin: 0px auto; }
iframe { max-width: 100%; width: 100%; border: none; }
.highlight td, .highlight tr { border: 0px; }
mark { background: rgb(255, 255, 0); color: rgb(0, 0, 0); }
.md-html-inline .md-plain, .md-html-inline strong, mark .md-inline-math, mark strong { color: inherit; }
.md-expand mark .md-meta { opacity: 0.3 !important; }
mark .md-meta { color: rgb(0, 0, 0); }
@media print {
  .typora-export h1, .typora-export h2, .typora-export h3, .typora-export h4, .typora-export h5, .typora-export h6 { break-inside: avoid; }
}
.md-diagram-panel .messageText { stroke: none !important; }
.md-diagram-panel .start-state { fill: var(--node-fill); }
.md-diagram-panel .edgeLabel rect { opacity: 1 !important; }
.md-require-zoom-fix { height: auto; margin-top: 16px; margin-bottom: 16px; }
.md-require-zoom-fix foreignobject { font-size: var(--mermaid-font-zoom); }
.md-fences.md-fences-math { font-size: 1em; }
.md-fences-advanced:not(.md-focus) { padding: 0px; white-space: nowrap; border: 0px; }
.md-fences-advanced:not(.md-focus) { background: inherit; }
.typora-export-show-outline .typora-export-content { max-width: 1440px; margin: auto; display: flex; flex-direction: row; }
.typora-export-sidebar { width: 300px; font-size: 0.8rem; margin-top: 80px; margin-right: 18px; }
.typora-export-show-outline #write { --webkit-flex:2; flex: 2 1 0%; }
.typora-export-sidebar .outline-content { position: fixed; top: 0px; max-height: 100%; overflow: hidden auto; padding-bottom: 30px; padding-top: 60px; width: 300px; }
@media screen and (max-width: 1024px) {
  .typora-export-sidebar, .typora-export-sidebar .outline-content { width: 240px; }
}
@media screen and (max-width: 800px) {
  .typora-export-sidebar { display: none; }
}
.outline-content li, .outline-content ul { margin-left: 0px; margin-right: 0px; padding-left: 0px; padding-right: 0px; list-style: none; }
.outline-content ul { margin-top: 0px; margin-bottom: 0px; }
.outline-content strong { font-weight: 400; }
.outline-expander { width: 1rem; height: 1.42857rem; position: relative; display: table-cell; vertical-align: middle; cursor: pointer; padding-left: 4px; }
.outline-expander::before { content: ""; position: relative; font-family: Ionicons; display: inline-block; font-size: 8px; vertical-align: middle; }
.outline-item { padding-top: 3px; padding-bottom: 3px; cursor: pointer; }
.outline-expander:hover::before { content: ""; }
.outline-h1 > .outline-item { padding-left: 0px; }
.outline-h2 > .outline-item { padding-left: 1em; }
.outline-h3 > .outline-item { padding-left: 2em; }
.outline-h4 > .outline-item { padding-left: 3em; }
.outline-h5 > .outline-item { padding-left: 4em; }
.outline-h6 > .outline-item { padding-left: 5em; }
.outline-label { cursor: pointer; display: table-cell; vertical-align: middle; text-decoration: none; color: inherit; }
.outline-label:hover { text-decoration: underline; }
.outline-item:hover { border-color: rgb(245, 245, 245); background-color: var(--item-hover-bg-color); }
.outline-item:hover { margin-left: -28px; margin-right: -28px; border-left: 28px solid transparent; border-right: 28px solid transparent; }
.outline-item-single .outline-expander::before, .outline-item-single .outline-expander:hover::before { display: none; }
.outline-item-open > .outline-item > .outline-expander::before { content: ""; }
.outline-children { display: none; }
.info-panel-tab-wrapper { display: none; }
.outline-item-open > .outline-children { display: block; }
.typora-export .outline-item { padding-top: 1px; padding-bottom: 1px; }
.typora-export .outline-item:hover { margin-right: -8px; border-right: 8px solid transparent; }
.typora-export .outline-expander::before { content: "+"; font-family: inherit; top: -1px; }
.typora-export .outline-expander:hover::before, .typora-export .outline-item-open > .outline-item > .outline-expander::before { content: "−"; }
.typora-export-collapse-outline .outline-children { display: none; }
.typora-export-collapse-outline .outline-item-open > .outline-children, .typora-export-no-collapse-outline .outline-children { display: block; }
.typora-export-no-collapse-outline .outline-expander::before { content: "" !important; }
.typora-export-show-outline .outline-item-active > .outline-item .outline-label { font-weight: 700; }
.md-inline-math-container mjx-container { zoom: 0.95; }


.CodeMirror { height: auto; }
.CodeMirror.cm-s-inner { background: inherit; }
.CodeMirror-scroll { overflow: auto hidden; z-index: 3; }
.CodeMirror-gutter-filler, .CodeMirror-scrollbar-filler { background-color: rgb(255, 255, 255); }
.CodeMirror-gutters { border-right: 1px solid rgb(221, 221, 221); background: inherit; white-space: nowrap; }
.CodeMirror-linenumber { padding: 0px 3px 0px 5px; text-align: right; color: rgb(153, 153, 153); }
.cm-s-inner .cm-keyword { color: rgb(119, 0, 136); }
.cm-s-inner .cm-atom, .cm-s-inner.cm-atom { color: rgb(34, 17, 153); }
.cm-s-inner .cm-number { color: rgb(17, 102, 68); }
.cm-s-inner .cm-def { color: rgb(0, 0, 255); }
.cm-s-inner .cm-variable { color: rgb(0, 0, 0); }
.cm-s-inner .cm-variable-2 { color: rgb(0, 85, 170); }
.cm-s-inner .cm-variable-3 { color: rgb(0, 136, 85); }
.cm-s-inner .cm-string { color: rgb(170, 17, 17); }
.cm-s-inner .cm-property { color: rgb(0, 0, 0); }
.cm-s-inner .cm-operator { color: rgb(152, 26, 26); }
.cm-s-inner .cm-comment, .cm-s-inner.cm-comment { color: rgb(170, 85, 0); }
.cm-s-inner .cm-string-2 { color: rgb(255, 85, 0); }
.cm-s-inner .cm-meta { color: rgb(85, 85, 85); }
.cm-s-inner .cm-qualifier { color: rgb(85, 85, 85); }
.cm-s-inner .cm-builtin { color: rgb(51, 0, 170); }
.cm-s-inner .cm-bracket { color: rgb(153, 153, 119); }
.cm-s-inner .cm-tag { color: rgb(17, 119, 0); }
.cm-s-inner .cm-attribute { color: rgb(0, 0, 204); }
.cm-s-inner .cm-header, .cm-s-inner.cm-header { color: rgb(0, 0, 255); }
.cm-s-inner .cm-quote, .cm-s-inner.cm-quote { color: rgb(0, 153, 0); }
.cm-s-inner .cm-hr, .cm-s-inner.cm-hr { color: rgb(153, 153, 153); }
.cm-s-inner .cm-link, .cm-s-inner.cm-link { color: rgb(0, 0, 204); }
.cm-negative { color: rgb(221, 68, 68); }
.cm-positive { color: rgb(34, 153, 34); }
.cm-header, .cm-strong { font-weight: 700; }
.cm-del { text-decoration: line-through; }
.cm-em { font-style: italic; }
.cm-link { text-decoration: underline; }
.cm-error { color: red; }
.cm-invalidchar { color: red; }
.cm-constant { color: rgb(38, 139, 210); }
.cm-defined { color: rgb(181, 137, 0); }
div.CodeMirror span.CodeMirror-matchingbracket { color: rgb(0, 255, 0); }
div.CodeMirror span.CodeMirror-nonmatchingbracket { color: rgb(255, 34, 34); }
.cm-s-inner .CodeMirror-activeline-background { background: inherit; }
.CodeMirror { position: relative; overflow: hidden; }
.CodeMirror-scroll { height: 100%; outline: 0px; position: relative; box-sizing: content-box; background: inherit; }
.CodeMirror-sizer { position: relative; }
.CodeMirror-gutter-filler, .CodeMirror-hscrollbar, .CodeMirror-scrollbar-filler, .CodeMirror-vscrollbar { position: absolute; z-index: 6; display: none; outline: 0px; }
.CodeMirror-vscrollbar { right: 0px; top: 0px; overflow: hidden; }
.CodeMirror-hscrollbar { bottom: 0px; left: 0px; overflow: auto hidden; }
.CodeMirror-scrollbar-filler { right: 0px; bottom: 0px; }
.CodeMirror-gutter-filler { left: 0px; bottom: 0px; }
.CodeMirror-gutters { position: absolute; left: 0px; top: 0px; padding-bottom: 10px; z-index: 3; overflow-y: hidden; }
.CodeMirror-gutter { white-space: normal; height: 100%; box-sizing: content-box; padding-bottom: 30px; margin-bottom: -32px; display: inline-block; }
.CodeMirror-gutter-wrapper { position: absolute; z-index: 4; background: 0px 0px !important; border: none !important; }
.CodeMirror-gutter-background { position: absolute; top: 0px; bottom: 0px; z-index: 4; }
.CodeMirror-gutter-elt { position: absolute; cursor: default; z-index: 4; }
.CodeMirror-lines { cursor: text; }
.CodeMirror pre { border-radius: 0px; border-width: 0px; background: 0px 0px; font-family: inherit; font-size: inherit; margin: 0px; white-space: pre; overflow-wrap: normal; color: inherit; z-index: 2; position: relative; overflow: visible; }
.CodeMirror-wrap pre { overflow-wrap: break-word; white-space: pre-wrap; word-break: normal; }
.CodeMirror-code pre { border-right: 30px solid transparent; width: fit-content; }
.CodeMirror-wrap .CodeMirror-code pre { border-right: none; width: auto; }
.CodeMirror-linebackground { position: absolute; inset: 0px; z-index: 0; }
.CodeMirror-linewidget { position: relative; z-index: 2; overflow: auto; }
.CodeMirror-wrap .CodeMirror-scroll { overflow-x: hidden; }
.CodeMirror-measure { position: absolute; width: 100%; height: 0px; overflow: hidden; visibility: hidden; }
.CodeMirror-measure pre { position: static; }
.CodeMirror div.CodeMirror-cursor { position: absolute; visibility: hidden; border-right: none; width: 0px; }
.CodeMirror div.CodeMirror-cursor { visibility: hidden; }
.CodeMirror-focused div.CodeMirror-cursor { visibility: inherit; }
.cm-searching { background: rgba(255, 255, 0, 0.4); }
span.cm-underlined { text-decoration: underline; }
span.cm-strikethrough { text-decoration: line-through; }
.cm-tw-syntaxerror { color: rgb(255, 255, 255); background-color: rgb(153, 0, 0); }
.cm-tw-deleted { text-decoration: line-through; }
.cm-tw-header5 { font-weight: 700; }
.cm-tw-listitem:first-child { padding-left: 10px; }
.cm-tw-box { border-style: solid; border-right-width: 1px; border-bottom-width: 1px; border-left-width: 1px; border-color: inherit; border-top-width: 0px !important; }
.cm-tw-underline { text-decoration: underline; }
@media print {
  .CodeMirror div.CodeMirror-cursor { visibility: hidden; }
}


:root {
    --side-bar-bg-color: #fafafa;
    --control-text-color: #777;
}

@include-when-export url(https://fonts.loli.net/css?family=Open+Sans:400italic,700italic,700,400&subset=latin,latin-ext);

/* open-sans-regular - latin-ext_latin */
  /* open-sans-italic - latin-ext_latin */
    /* open-sans-700 - latin-ext_latin */
    /* open-sans-700italic - latin-ext_latin */
  html {
    font-size: 16px;
    -webkit-font-smoothing: antialiased;
}

body {
    font-family: "Open Sans","Clear Sans", "Helvetica Neue", Helvetica, Arial, 'Segoe UI Emoji', sans-serif;
    color: rgb(51, 51, 51);
    line-height: 1.6;
}

#write {
    max-width: 860px;
  	margin: 0 auto;
  	padding: 30px;
    padding-bottom: 100px;
}

@media only screen and (min-width: 1400px) {
	#write {
		max-width: 1024px;
	}
}

@media only screen and (min-width: 1800px) {
	#write {
		max-width: 1200px;
	}
}

#write > ul:first-child,
#write > ol:first-child{
    margin-top: 30px;
}

a {
    color: #4183C4;
}
h1,
h2,
h3,
h4,
h5,
h6 {
    position: relative;
    margin-top: 1rem;
    margin-bottom: 1rem;
    font-weight: bold;
    line-height: 1.4;
    cursor: text;
}
h1:hover a.anchor,
h2:hover a.anchor,
h3:hover a.anchor,
h4:hover a.anchor,
h5:hover a.anchor,
h6:hover a.anchor {
    text-decoration: none;
}
h1 tt,
h1 code {
    font-size: inherit;
}
h2 tt,
h2 code {
    font-size: inherit;
}
h3 tt,
h3 code {
    font-size: inherit;
}
h4 tt,
h4 code {
    font-size: inherit;
}
h5 tt,
h5 code {
    font-size: inherit;
}
h6 tt,
h6 code {
    font-size: inherit;
}
h1 {
    font-size: 2.25em;
    line-height: 1.2;
    border-bottom: 1px solid #eee;
}
h2 {
    font-size: 1.75em;
    line-height: 1.225;
    border-bottom: 1px solid #eee;
}

/*@media print {
    .typora-export h1,
    .typora-export h2 {
        border-bottom: none;
        padding-bottom: initial;
    }

    .typora-export h1::after,
    .typora-export h2::after {
        content: "";
        display: block;
        height: 100px;
        margin-top: -96px;
        border-top: 1px solid #eee;
    }
}*/

h3 {
    font-size: 1.5em;
    line-height: 1.43;
}
h4 {
    font-size: 1.25em;
}
h5 {
    font-size: 1em;
}
h6 {
   font-size: 1em;
    color: #777;
}
p,
blockquote,
ul,
ol,
dl,
table{
    margin: 0.8em 0;
}
li>ol,
li>ul {
    margin: 0 0;
}
hr {
    height: 2px;
    padding: 0;
    margin: 16px 0;
    background-color: #e7e7e7;
    border: 0 none;
    overflow: hidden;
    box-sizing: content-box;
}

li p.first {
    display: inline-block;
}
ul,
ol {
    padding-left: 30px;
}
ul:first-child,
ol:first-child {
    margin-top: 0;
}
ul:last-child,
ol:last-child {
    margin-bottom: 0;
}
blockquote {
    border-left: 4px solid #dfe2e5;
    padding: 0 15px;
    color: #777777;
}
blockquote blockquote {
    padding-right: 0;
}
table {
    padding: 0;
    word-break: initial;
}
table tr {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 0;
}
table tr:nth-child(2n),
thead {
    background-color: #f8f8f8;
}
table th {
    font-weight: bold;
    border: 1px solid #dfe2e5;
    border-bottom: 0;
    margin: 0;
    padding: 6px 13px;
}
table td {
    border: 1px solid #dfe2e5;
    margin: 0;
    padding: 6px 13px;
}
table th:first-child,
table td:first-child {
    margin-top: 0;
}
table th:last-child,
table td:last-child {
    margin-bottom: 0;
}

.CodeMirror-lines {
    padding-left: 4px;
}

.code-tooltip {
    box-shadow: 0 1px 1px 0 rgba(0,28,36,.3);
    border-top: 1px solid #eef2f2;
}

.md-fences,
code,
tt {
    border: 1px solid #e7eaed;
    background-color: #f8f8f8;
    border-radius: 3px;
    padding: 0;
    padding: 2px 4px 0px 4px;
    font-size: 0.9em;
}

code {
    background-color: #f3f4f4;
    padding: 0 2px 0 2px;
}

.md-fences {
    margin-bottom: 15px;
    margin-top: 15px;
    padding-top: 8px;
    padding-bottom: 6px;
}


.md-task-list-item > input {
  margin-left: -1.3em;
}

@media print {
    html {
        font-size: 13px;
    }
    table,
    pre {
        page-break-inside: avoid;
    }
    pre {
        word-wrap: break-word;
    }
}

.md-fences {
	background-color: #f8f8f8;
}
#write pre.md-meta-block {
	padding: 1rem;
    font-size: 85%;
    line-height: 1.45;
    background-color: #f7f7f7;
    border: 0;
    border-radius: 3px;
    color: #777777;
    margin-top: 0 !important;
}

.mathjax-block>.code-tooltip {
	bottom: .375rem;
}

.md-mathjax-midline {
    background: #fafafa;
}

#write>h3.md-focus:before{
	left: -1.5625rem;
	top: .375rem;
}
#write>h4.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h5.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
#write>h6.md-focus:before{
	left: -1.5625rem;
	top: .285714286rem;
}
.md-image>.md-meta {
    /*border: 1px solid #ddd;*/
    border-radius: 3px;
    padding: 2px 0px 0px 4px;
    font-size: 0.9em;
    color: inherit;
}

.md-tag {
    color: #a7a7a7;
    opacity: 1;
}

.md-toc { 
    margin-top:20px;
    padding-bottom:20px;
}

.sidebar-tabs {
    border-bottom: none;
}

#typora-quick-open {
    border: 1px solid #ddd;
    background-color: #f8f8f8;
}

#typora-quick-open-item {
    background-color: #FAFAFA;
    border-color: #FEFEFE #e5e5e5 #e5e5e5 #eee;
    border-style: solid;
    border-width: 1px;
}

/** focus mode */
.on-focus-mode blockquote {
    border-left-color: rgba(85, 85, 85, 0.12);
}

header, .context-menu, .megamenu-content, footer{
    font-family: "Segoe UI", "Arial", sans-serif;
}

.file-node-content:hover .file-node-icon,
.file-node-content:hover .file-node-open-state{
    visibility: visible;
}

.mac-seamless-mode #typora-sidebar {
    background-color: #fafafa;
    background-color: var(--side-bar-bg-color);
}

.md-lang {
    color: #b4654d;
}

/*.html-for-mac {
    --item-hover-bg-color: #E6F0FE;
}*/

#md-notification .btn {
    border: 0;
}

.dropdown-menu .divider {
    border-color: #e5e5e5;
    opacity: 0.4;
}

.ty-preferences .window-content {
    background-color: #fafafa;
}

.ty-preferences .nav-group-item.active {
    color: white;
    background: #999;
}

.menu-item-container a.menu-style-btn {
    background-color: #f5f8fa;
    background-image: linear-gradient( 180deg , hsla(0, 0%, 100%, 0.8), hsla(0, 0%, 100%, 0)); 
}


 :root {--mermaid-font-zoom:1.75em ;} 
</style><title>index</title>
</head>
<body class='typora-export os-windows'><div class='typora-export-content'>
<div id='write'  class=''><h1 id='azure-language-areas'><span>Azure Language Areas</span></h1><p><img src=".\images\AzureA.PNG" alt="AzureA" style="zoom:43%;" /><img src=".\images\MiniMap.PNG" alt="MiniMap" style="zoom: 25%;" /></p><p><span>Many Microsoft Azure technologies are used to recreate my research methodology for &quot;Language Areas&quot; (LAs), a geodemographic technique for exploring the diversity of neighbours via the language spoken most often at home. Previous </span><a href='https://public.tableau.com/app/profile/ian.mosley/viz/Book3_15960299485480/CreatingLanguageAreas'><span>investigations</span></a><span> have always used &#39;desktop&#39; technologies, principally </span><a href='https://www.anaconda.com/products/individual'><span>Python</span></a><span> and </span><a href='https://www.microsoft.com/en-us/Download/details.aspx?id=101064'><span>MS SQL Server + Spatial</span></a><span>. Now I&#39;m attempting it &quot;in the cloud&quot;  and investigating the most cost effective, smaller scale technologies</span><sup class='md-footnote'><a href='#dfref-footnote-1' name='ref-footnote-1'>1</a></sup><span> to aid companies that are just getting accustomed with Azure concepts.</span></p><h2 id='why'><span>Why</span></h2><p><span>I had been working for a small company that was progressively adopting Azure technology for backend systems: </span><a href='https://docs.microsoft.com/en-us/azure/active-directory/fundamentals/active-directory-whatis'><span>Azure Active Directory</span></a><span>, </span><a href='https://docs.microsoft.com/en-us/azure/devops/user-guide/what-is-azure-devops?view=azure-devops'><span>Azure DevOps</span></a><span>, multiple virtual machines and SQL Databases (along with all the other Microsoft goodness: Office365, Exchange, and Teams). As a data engineer it was an interesting experience comparing a regular Microsoft SQL Server instance residing on a VM versus the constraints of a Azure SQL Database (my first analytic PaaS). The challenge is to see how far I can leverage Azure-only technology, policies and processes.</span></p><h2 id='objective'><span>Objective</span></h2><p><span>There are two goals: a) </span><em><span>lift-and-shift</span></em><span> the existing data and modelling processes into the cloud, and b) redesign the statistical and spatial processing for a scalable, </span><strong><span>MPP</span></strong><span>, environment.</span></p><p><span>Currently all raw data, metadata and code reside on a LAN, and development and prototyping performed on a desktop computer using SQL Server and Python (Anaconda). Larger model execution is tested on a remote SQL Server instance using SQL Server Management Studio and validated with scheduled </span><code>sqlcmd</code><span> jobs &#39;overnight&#39; (for demanding spatial computation PostgreSQL is substituted). Final data processing code and model code is then committed to a repository.</span></p><p><span>The </span><em><span>lift-and-shift</span></em><span> is mostly about: replacing UNC paths with linked service connections to BLOB storage, moving Python code into Databricks, standing-up Azure managed SQL or PostgreSQL databases of various types, and the ability to have one central repo. Furthermore, a change in perspective is required: going from a compute-centric view, to a top-down Azure resource management gestalt.</span></p><p><span>The MPP opportunities are new and exciting. Most of the spatial processing is linear but Apache Sedona on Databricks can scale these problems horizontally. Also, reordering overall dependencies, micro-batch jobs are possible utilizing vertical scaling too with Azure SQL Database and Azure Database for PostgreSQL (Single Server). All of this is possible with just a few clicks in the Azure Portal or commands in the Azure CLI.</span></p><h2 id='overall-process'><span>Overall Process</span></h2><p><span>To implement LA research, a broad range of data engineering and science technologies is required: </span></p><ul><li><span>BLOB storage for raw, &#39;bronze&#39;, data,</span></li><li><span>ELT processes to create &#39;silver&#39; grade data at rest,</span></li><li><span>Python for EDA and complex modeling,</span></li><li><span>A unified code repository, and,</span></li><li><span>Power BI for presentation.</span></li></ul><div class="md-diagram-panel md-fences-adv-panel"><svg height="775.9375" version="1.1" width="325.796875" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" style="overflow: hidden; position: relative; left: -0.142857px; top: -0.205357px;" viewBox="0 0 325.796875 775.9375" preserveAspectRatio="xMidYMid meet"><desc style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Created with Raphaël 2.2.0</desc><defs style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><path stroke-linecap="round" d="M5,0 0,2.5 5,5z" id="raphael-marker-block" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><marker id="raphael-marker-endblock33-objyzgdx" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="currentColor" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objcn0p4" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="currentColor" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objgcpkp" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="currentColor" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objqqr8s" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="currentColor" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj3gxdk" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="currentColor" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-obj6qppw" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="currentColor" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objdwv7s" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="currentColor" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker><marker id="raphael-marker-endblock33-objegh20" markerHeight="3" markerWidth="3" orient="auto" refX="1.5" refY="1.5" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"><use xlink:href="#raphael-marker-block" transform="rotate(180 1.5 1.5) scale(0.6,0.6)" stroke-width="1.6667" fill="currentColor" stroke="none" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></use></marker></defs><rect x="0" y="0" width="286.640625" height="35.4375" rx="20" ry="20" fill="var(--bg-color)" stroke="currentColor" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="3" class="flowchart" id="st" transform="matrix(1,0,0,1,21.0781,6)"></rect><text x="10" y="17.71875" text-anchor="start" font-family="&quot;Arial&quot;" font-size="14px" stroke="none" fill="currentColor" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 14px;" id="stt" class="flowchartt" transform="matrix(1,0,0,1,21.0781,6)" stroke-width="1"><tspan dy="4.859375" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Consolidate data in Azure BLOB Container</tspan></text><path fill="var(--bg-color)" stroke="currentColor" d="M10,17.71875L0,35.4375L100.4375,35.4375L120.4375,0L20,0L10,17.71875" stroke-width="3" id="io1" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" transform="matrix(1,0,0,1,104.1797,97.4375)"></path><text x="30" y="17.71875" text-anchor="start" font-family="&quot;Arial&quot;" font-size="14px" stroke="none" fill="currentColor" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 14px;" id="io1t" class="flowchartt" transform="matrix(1,0,0,1,104.1797,97.4375)" stroke-width="1"><tspan dy="4.859375" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Start ELT:</tspan></text><rect x="0" y="0" width="170.953125" height="35.4375" rx="0" ry="0" fill="var(--bg-color)" stroke="currentColor" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="3" class="flowchart" id="sub1" transform="matrix(1,0,0,1,78.9219,188.875)"></rect><rect x="10" y="0" width="150.953125" height="35.4375" rx="0" ry="0" fill="var(--bg-color)" stroke="currentColor" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="3" id="sub1i" transform="matrix(1,0,0,1,78.9219,188.875)"></rect><text x="20" y="17.71875" text-anchor="start" font-family="&quot;Arial&quot;" font-size="14px" stroke="none" fill="currentColor" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 14px;" id="sub1t" class="flowchartt" transform="matrix(1,0,0,1,78.9219,188.875)" stroke-width="1"><tspan dy="4.859375" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Process Spatial Data</tspan></text><rect x="0" y="0" width="235.53125" height="35.4375" rx="0" ry="0" fill="var(--bg-color)" stroke="currentColor" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="3" class="flowchart" id="sub2" transform="matrix(1,0,0,1,46.6328,280.3125)"></rect><rect x="10" y="0" width="215.53125" height="35.4375" rx="0" ry="0" fill="var(--bg-color)" stroke="currentColor" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="3" id="sub2i" transform="matrix(1,0,0,1,46.6328,280.3125)"></rect><text x="20" y="17.71875" text-anchor="start" font-family="&quot;Arial&quot;" font-size="14px" stroke="none" fill="currentColor" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 14px;" id="sub2t" class="flowchartt" transform="matrix(1,0,0,1,46.6328,280.3125)" stroke-width="1"><tspan dy="4.859375" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Convert Unstructured Metadata</tspan></text><rect x="0" y="0" width="156.171875" height="35.4375" rx="0" ry="0" fill="var(--bg-color)" stroke="currentColor" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="3" class="flowchart" id="sub3" transform="matrix(1,0,0,1,86.3125,371.75)"></rect><rect x="10" y="0" width="136.171875" height="35.4375" rx="0" ry="0" fill="var(--bg-color)" stroke="currentColor" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="3" id="sub3i" transform="matrix(1,0,0,1,86.3125,371.75)"></rect><text x="20" y="17.71875" text-anchor="start" font-family="&quot;Arial&quot;" font-size="14px" stroke="none" fill="currentColor" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 14px;" id="sub3t" class="flowchartt" transform="matrix(1,0,0,1,86.3125,371.75)" stroke-width="1"><tspan dy="4.859375" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Copy Tabular Data</tspan></text><path fill="var(--bg-color)" stroke="currentColor" d="M10,17.71875L0,35.4375L296.796875,35.4375L316.796875,0L20,0L10,17.71875" stroke-width="3" id="io2" class="flowchart" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" transform="matrix(1,0,0,1,6,463.1875)"></path><text x="30" y="17.71875" text-anchor="start" font-family="&quot;Arial&quot;" font-size="14px" stroke="none" fill="currentColor" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 14px;" id="io2t" class="flowchartt" transform="matrix(1,0,0,1,6,463.1875)" stroke-width="1"><tspan dy="4.859375" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">ELT complete, load into staging database</tspan></text><rect x="0" y="0" width="49.171875" height="35.4375" rx="0" ry="0" fill="var(--bg-color)" stroke="currentColor" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="3" class="flowchart" id="op1" transform="matrix(1,0,0,1,139.8125,554.625)"></rect><text x="10" y="17.71875" text-anchor="start" font-family="&quot;Arial&quot;" font-size="14px" stroke="none" fill="currentColor" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 14px;" id="op1t" class="flowchartt" transform="matrix(1,0,0,1,139.8125,554.625)" stroke-width="1"><tspan dy="4.859375" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">EDA</tspan></text><rect x="0" y="0" width="96.828125" height="35.4375" rx="0" ry="0" fill="var(--bg-color)" stroke="currentColor" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="3" class="flowchart" id="sub4" transform="matrix(1,0,0,1,115.9844,646.0625)"></rect><rect x="10" y="0" width="76.828125" height="35.4375" rx="0" ry="0" fill="var(--bg-color)" stroke="currentColor" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="3" id="sub4i" transform="matrix(1,0,0,1,115.9844,646.0625)"></rect><text x="20" y="17.71875" text-anchor="start" font-family="&quot;Arial&quot;" font-size="14px" stroke="none" fill="currentColor" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 14px;" id="sub4t" class="flowchartt" transform="matrix(1,0,0,1,115.9844,646.0625)" stroke-width="1"><tspan dy="4.859375" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Modeling</tspan></text><rect x="0" y="0" width="98.609375" height="35.4375" rx="20" ry="20" fill="var(--bg-color)" stroke="currentColor" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);" stroke-width="3" class="flowchart" id="e" transform="matrix(1,0,0,1,115.0938,737.5)"></rect><text x="10" y="17.71875" text-anchor="start" font-family="&quot;Arial&quot;" font-size="14px" stroke="none" fill="currentColor" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0); text-anchor: start; font-family: Arial; font-size: 14px;" id="et" class="flowchartt" transform="matrix(1,0,0,1,115.0938,737.5)" stroke-width="1"><tspan dy="4.859375" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);">Presentation</tspan></text><path fill="none" stroke="currentColor" d="M164.3984375,41.4375C164.3984375,41.4375,164.3984375,79.63827085494995,164.3984375,92.93766031763516" stroke-width="3" marker-end="url(#raphael-marker-endblock33-objyzgdx)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="currentColor" d="M164.3984375,132.875C164.3984375,132.875,164.3984375,171.07577085494995,164.3984375,184.37516031763516" stroke-width="3" marker-end="url(#raphael-marker-endblock33-objcn0p4)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="currentColor" d="M164.3984375,224.3125C164.3984375,224.3125,164.3984375,262.51327085494995,164.3984375,275.81266031763516" stroke-width="3" marker-end="url(#raphael-marker-endblock33-objgcpkp)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="currentColor" d="M164.3984375,315.75C164.3984375,315.75,164.3984375,353.95077085494995,164.3984375,367.25016031763516" stroke-width="3" marker-end="url(#raphael-marker-endblock33-objqqr8s)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="currentColor" d="M164.3984375,407.1875C164.3984375,407.1875,164.3984375,445.38827085494995,164.3984375,458.68766031763516" stroke-width="3" marker-end="url(#raphael-marker-endblock33-obj3gxdk)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="currentColor" d="M164.3984375,498.625C164.3984375,498.625,164.3984375,536.82577085495,164.3984375,550.1251603176352" stroke-width="3" marker-end="url(#raphael-marker-endblock33-obj6qppw)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="currentColor" d="M164.3984375,590.0625C164.3984375,590.0625,164.3984375,628.26327085495,164.3984375,641.5626603176352" stroke-width="3" marker-end="url(#raphael-marker-endblock33-objdwv7s)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path><path fill="none" stroke="currentColor" d="M164.3984375,681.5C164.3984375,681.5,164.3984375,719.70077085495,164.3984375,733.0001603176352" stroke-width="3" marker-end="url(#raphael-marker-endblock33-objegh20)" style="-webkit-tap-highlight-color: rgba(0, 0, 0, 0);"></path></svg></div><h2 id='technologies-used'><span>Technologies Used</span></h2><p><span>With the objective of exclusively leveraging Azure, here are the technologies used, the ones that were not fit-for-purpose, and their replacements. In some cases I did resort to desktop technology since Azure was getting expensive.</span></p><ul><li><a href='https://docs.microsoft.com/en-us/azure/storage/blobs/storage-blobs-introduction'><span>Azure BLOB Storage</span></a><span> container (hierarchical namespace are not implemented)</span></li><li><a href='https://docs.microsoft.com/en-us/azure/key-vault/general/basic-concepts'><span>Azure Key Vault</span></a><span> to store shared access signatures (SAS)</span></li><li><a href='https://docs.microsoft.com/en-us/azure/databricks/scenarios/what-is-azure-databricks'><span>Azure Databricks</span></a><span> Service with </span><a href='https://sedona.apache.org/'><span>Apache Sedona</span></a><span> for ELT of spatial data via </span><a href='https://en.wikipedia.org/wiki/Apache_Spark#Overview'><span>RDDs</span></a></li><li><a href='https://docs.microsoft.com/en-us/azure/data-factory/introduction'><span>Azure Data Factory</span></a><span> (ADF) for ELT of unstructured and CSV data, and copy of prepared spatial data</span></li><li><span>Azure Database for PostgresSQL (PG) </span><a href='https://docs.microsoft.com/en-us/azure/postgresql/concepts-servers'><span>Single Server</span></a><span> (Basic 2 vCore) as target for ELT</span></li><li><a href='https://docs.microsoft.com/en-us/sql/azure-data-studio/what-is-azure-data-studio?view=sql-server-ver15'><span>Azure Data Studio</span></a><span> for managing code and connecting to PG</span></li><li><em><span>Originally</span></em><span> planned to use PySpark/Scala in Databricks for EDA, but I did not successfully integrate Apache Sedona with SparkSQL so opted to use the PG staging server for EDA</span></li><li><span>ML modeling accomplished using a second PG Single Server (General Purpose 8 vCore) </span><sup class='md-footnote'><a href='#dfref-footnote-2' name='ref-footnote-2'>2</a></sup></li><li><span>Copied model results with ADF to Azure SQL Database for final implementation (a &#39;production&#39; database)</span></li><li><span>Intended to use </span><a href='https://docs.microsoft.com/en-us/power-bi/fundamentals/power-bi-overview'><span>Power BI</span></a><span> to create maps and charts but it would not properly ingest geometry/geography data types, simply interpreting them as varchar, so instead:</span></li><li><a href='https://www.tableau.com/products/desktop'><span>Tableau Desktop</span></a><span> and </span><a href='https://public.tableau.com/en-us/s/'><span>Tableau Public</span></a><span> to create interactive maps showing the impact of LA calculations versus simple Dissemination Area density metrics</span></li><li><a href='https://docs.microsoft.com/en-us/azure/devops/user-guide/what-is-azure-devops?view=azure-devops'><span>Azure DevOps</span></a><span> for code management and version control across Databricks, ADF and PG</span></li></ul><h2 id='azure-blob-storage'><span>Azure BLOB storage</span></h2><p><span>Source data consists of:</span></p><ul><li><span>Statistics Canada (StatCan) </span><a href='https://www12.statcan.gc.ca/census-recensement/2016/dp-pd/index-eng.cfm'><span>Census 2016</span></a><span> CSV tabular data for Single Response </span><a href='https://www150.statcan.gc.ca/n1/en/catalogue/98-401-X2016044'><span>Home Language</span></a><span> counts by Dissemination Area (DA)</span></li><li><span>Unstructured metadata text file describing the above data. This file is required to create a data dictionary.</span></li><li><span>StatCan Census 2016 </span><a href='https://www12.statcan.gc.ca/census-recensement/alternative_alternatif.cfm?l=eng&amp;dispext=zip&amp;teng=lda_000b16a_e.zip&amp;k=%20%20%20%2090414&amp;loc=http://www12.statcan.gc.ca/census-recensement/2011/geo/bound-limit/files-fichiers/2016/lda_000b16a_e.zip'><span>Dissemination Area</span></a><span> boundary files in binary &#39;ShapeFile&#39; format using StatCan custom projection in meters (</span><a href='https://epsg.io/3347'><span>EPSG:3347</span></a><span>)</span></li></ul><p><span>After processing the Shapefile into Well Known Text (WKT) via Databricks, it was copied into a &#39;Silver&#39; BLOB container for later loading into PG.</span></p><h2 id='azure-data-factory'><span>Azure Data Factory</span></h2><p><span>If you are familiar with Microsoft&#39;s SQL Server Integration Services (SSIS), then you have an idea of the workflow for using ADF. Comparing the metadata text file processing mentioned above using: a) SSIS, b) ADF Integration Runtime for SSIS packages</span><sup class='md-footnote'><a href='#dfref-footnote-3' name='ref-footnote-3'>3</a></sup><span>, and c) rewriting the whole process in native ADF dataflows and pipeline(s), the effort is similar except native ADF dataflows are much more forgiving regarding casting datatypes than SSIS.</span></p><p><span>As shown in the image below, all data preparation is in a single pipeline &quot;PrepareCensusData&quot; that starts a Databricks Notebook &quot;readShapeFileSilver&quot; converting the binary shapefiles into text (more on that later), </span></p><p><img src=".\images\PrepareCensusData_pl_crop.png" referrerpolicy="no-referrer" alt="PrepareCensusData_pl_crop"></p><p><span>and then calling the data flow &quot;LoadTextFiles&quot;.</span></p><p><img src=".\images\LoadTextFiles_df.png" referrerpolicy="no-referrer" alt="LoadTextFiles_df"></p><p><span>The value of ADF is the &quot;no code&quot; approach:</span></p><ol start='' ><li><span>Read the file from BLOB storage</span></li><li><span>Strip out unnecessary rows from the file that included lengthy headers and footers, and remove duplicate lines. This is done in a flexible way so new metadata files can be processed dynamically and not rely on row counts etc.</span></li><li><span>Parse the required columns that were semi-structured</span></li><li><span>Validate the columns with data type checks</span></li><li><span>Create the hierarchy datum that categorizes rows (very important when working with StatCan census data)</span></li><li><span>Insert the data into a PG database table</span></li></ol><p><span>For the tabular StatCan Home Language counts CSV file, the dataflow:</span></p><ol start='' ><li><span>Read the file from BLOB storage</span></li><li><span>Remove StatCan column values that represent various forms of value suppression and replace with </span><em><span>NULLs</span></em><span> (there are four different types of suppression, so it is important to apply the correct business rules depending on the context)</span></li><li><span>Insert the data into a PG table</span></li></ol><p><span>Finally, the shapefile data converted to WKT via the Databricks notebook is copied from BLOB storage directly into a PG table.</span></p><h2 id='azure-databricks'><span>Azure Databricks</span></h2><p><span>Ideally, most of the ELT, EDA and modeling would have been accomplished with Azure Databricks principally using Scala, Python and SQL. However, as noted previously, I was unable to configure Databricks successfully to enjoy the full capabilities of Apache Sedona, especially SpatialSQL&#39;s horizontal scaling.</span></p><p><span>Regardless, Python (i.e. PySpark) is used to securely read and write data using SAS tokens via an Azure Key Store, and Scala + Sedona converts the Shapefile to RDD and saved as WKT for consumption by either SQL Server Spatial or PostGIS.</span></p><p><span>Please review this </span><a href='./source/readShapefileSilver.pdf'><span>notebook</span></a><span> (PDF).</span></p><h2 id='postgresql-for-elt-and-eda'><span>PostgreSQL for ELT and EDA</span></h2><p><span>In previous work experience I dabbled with PostgresSQL but nothing that would qualify as &quot;data science&quot;. Since I have extensive experience with SQL Server and its Spatial functions, I wanted to explore PG and its spatial extension </span><a href='https://postgis.net/'><span>PostGIS</span></a><span>.</span></p><p><span>As mentioned previously, all data &#39;arrived&#39; in PG via an ADF pipeline.</span></p><p><span>The 2 vCore Basic server is sufficient for simple EDA: cardinality counts across dimensions, simple spatial geometry validation checks, and univariate statistical distribution calculations. Not surprising since the total database size is only 16GB, and larger tables have row counts of less than 120M (the tables are narrow). </span></p><p><span>However, when performing spatial algebra it was slow. As mentioned in the Microsoft documentation, the &#39;Basic&#39; server configuration has &quot;Variable I/O performance&quot;, it most certainly does. (I benchmarked some spatial operations against a Raspberry Pi 4 with 8GB of RAM and the latter is faster.)</span></p><p><span>Once EDA was complete and data integrity established, model validation was run on the 2 vCore Basic server as proof-of-concept</span><sup class='md-footnote'><a href='#dfref-footnote-4' name='ref-footnote-4'>4</a></sup><span>. Not surprisingly, in order to have the model complete in hours and not days, faster hardware is required, specifically more cores as the model was ammenable to parallelization.</span></p><h2 id='postgresql-for-modeling'><span>PostgreSQL for Modeling</span></h2><p><span>A big part of the model is spatially agglomerating adjacent DAs based on similar home language attributes. Since there are over 250 home languages in the Census, and each language is an exclusive problem set, the model can converge ||250+|| times. Similarly, calculating the descriptive statistics of the home language agglomerations can be done in parallel. So more cores would be ideal.</span></p><p><span>Enter the Azure 8 vCore General Purpose PG server (with &#39;predictable&#39; I/O performance. Nice.) The data are copied from the EDA PG server using the Azure CLI with the PG </span><code>dump</code><span> and </span><code>psql</code><span> utilities. This is much faster to setup and run than using ADF</span><sup class='md-footnote'><a href='#dfref-footnote-5' name='ref-footnote-5'>5</a></sup><span>. Using the combination of a pinned Azure PG monitoring dashboard, and Windows 10 </span><code>cmd</code><span> sessions, I initiated eight model runs in parallel to agglomerate the 250+ home language solutions. </span></p><p><span>The majority finished within 24 hours, but three solutions proved onerous: English, French and Non-official languages. This condition was understandable, all three languages covered a spatially extensive portion of Canada and even prudent data modelling </span>&#151;<span> spatial GiST and B-tree index use </span>&#151;<span> would not speed things up. This is a </span><a href='https://en.wikipedia.org/wiki/NP-hardness'><span>hard NP</span></a><span> problem. </span></p><p><span>Moreover, the 8 vCore PG server was getting expensive so the model processing was suspended (it was coded for this eventuality, allowing a restart due to server error, rollback, user intervention etc.) and eventually deleted (it has no Azure &#39;pause&#39; feature). I moved the required tables to the previously mentioned &#39;Pi and restarted. The French and English solutions completed within the next 48 hours but the Non-official language solution went on for days, eventually I abandoned it. (An item for the &quot;Further Research&quot; section.)</span></p><p><span>Likewise, the descriptive statistics were performed on the &#39;Pi since I didn&#39;t want to incur more costs for spinning-up an expensive resource. </span></p><h2 id='tableau-rather-than-power-bi'><span>Tableau Rather than Power BI</span></h2><p><span>So I was stunned: Power BI does not know what to make of SQL Server geometry/geography types. Using ADF&#39;s copy data activity, I exported data</span><sup class='md-footnote'><a href='#dfref-footnote-6' name='ref-footnote-6'>6</a></sup><span> from the 2 vCore Basic PG server to a newly created Azure SQL Database. Then accessing the latter from a Power BI workspace, I &quot;dragged and dropped&quot; the geography column onto the report canvas and it simply displayed as a string type &quot;MULTIPOLYGON(((...)))&quot;. What a letdown.</span></p><p><span>Conversely, in Tableau Desktop, I dragged the same column onto a worksheet and immediately interpreted as a &#39;map&#39; and created polygons across Canada with a base map too. In addition, adding relational tables to the map data (not a blend within a worksheet, that would overwhelm Tableau) allowed </span><a href='https://iamosley.github.io/azure_la/'><span>interactive charts</span></a><span> for each polygon (over 50,000 of them!), so the user could see the impact of LA calculations versus simple DA densities.</span></p><p><span>Since the Azure SQL Database was created just for Power BI, and Tableau Desktop was fine connecting to a Azure PG database, I deleted the SQL Database and used the 2 vCore Basic PG server for provisioning data for Tableau.</span></p><h1 id='conclusions'><span>Conclusions</span></h1><p><span>It is great having everything in one place with Azure. From sourcing data in BLOB containers, processing for ELT in Azure Data Factory, to EDA and ML modeling in Databricks or any of the PaaS SQL options, there is a lot of flexibility. Furthermore, having Azure DevOps as a single source for code spanning all these technologies is a CI/CD (and organizational) benefit. </span></p><p><span>The key to successfully leveraging Azure is to view it principally as a resource manager with integrated security policies. A huge asset for a company of any size. It is not so much deciding exactly how to configure the capacity of a resource (VM, SQL server, ADF, etc.) first time around, but to keep a sharp eye on utilization, determine ROI for possible production deployment, and have a clear set of business rules for pausing or deleting a resource to minimize costs. </span></p><p><span>For a data engineer/scientist like myself, who is used to an &quot;always on, always available&quot; mentality, the allocate-deallocate mindset required for Azure took some adjustment, but enforces a much needed discipline around resourcing and budgeting, and removal of the largesse approach of unlimited data science provisioning.</span></p><div class='footnotes-area'  ><hr/>
<div class='footnote-line'><span class='md-fn-count'>1</span> <span>My initial exploration of Azure was done with a &#39;free&#39; 30-day subscription. However, all processing mentioned here uses a pay-as-you-go subscription </span>&#151;<span> with some surprising costs incurred </span>&#151;<span> which impacted the methodology and goals. Also, to prevent unexpected bills, I did not implement </span><a href='https://docs.microsoft.com/en-us/azure/cosmos-db/introduction'><span>CosmosDB</span></a><span> or </span><a href='https://docs.microsoft.com/en-us/azure/synapse-analytics/'><span>Azure Synapse Analytics</span></a><span>, two technologies &quot;out of the box&quot; that are too expensive to dabble in (though Synapse Analytics is an impressive ecosystem: a seamless integration of ingestion, modeling and reporting).</span> <a name='dfref-footnote-1' href='#ref-footnote-1' title='back to document' class='reversefootnote' >↩</a></div>
<div class='footnote-line'><span class='md-fn-count'>2</span> <span>Towards the end of processing I had to move data to my desktop PostgresSQL (Debian) to finish processing as the 8 vCore machine was getting very expensive!</span> <a name='dfref-footnote-2' href='#ref-footnote-2' title='back to document' class='reversefootnote' >↩</a></div>
<div class='footnote-line'><span class='md-fn-count'>3</span> <span>I found the Integration Runtime somewhat buggy: if you changed any package global parameters and republised them, the ADF runtime would not integrate the change: you had to delete the package and start fresh.</span> <a name='dfref-footnote-3' href='#ref-footnote-3' title='back to document' class='reversefootnote' >↩</a></div>
<div class='footnote-line'><span class='md-fn-count'>4</span> <span>As part of model development, its procedural language beginnings were replaced with set-based spatial SQL operations that took advantage of PG GiST indexes. Not a subtle process given that the presence of a spatial operations and GiST indexes precludes the use of any B-tree index (not unlike MS SQL Server spatial functions).</span> <a name='dfref-footnote-4' href='#ref-footnote-4' title='back to document' class='reversefootnote' >↩</a></div>
<div class='footnote-line'><span class='md-fn-count'>5</span> <span>Note that the Azure CLI should only be used for administrative tasks. For example, during EDA the CLI would timeout due to &#39;inactivity&#39; even when using an active psql session, and thus lose that session&#39;s results.</span> <a name='dfref-footnote-5' href='#ref-footnote-5' title='back to document' class='reversefootnote' >↩</a></div>
<div class='footnote-line'><span class='md-fn-count'>6</span> <span>This was an involved process and beyond the scope of this post. Simply, I </span><code>psql \copy</code><span> tables from the local &#39;Pi PG server to a text file and had QGIS convert the projection from StatCan meter to the WGS Longitude Latitude and saved as a WKT file. Then I uploaded the tables via </span><code>psql \copy</code><span> into the Azure PG server.</span> <a name='dfref-footnote-6' href='#ref-footnote-6' title='back to document' class='reversefootnote' >↩</a></div></div></div></div>
</body>
</html>